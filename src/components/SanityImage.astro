---
import { urlForImage } from "~/lib/sanity/urlForImage";
import type { internalGroqTypeReferenceTo, SanityImageAsset } from "~/t/sanity";

interface SanityImageRef {
  _ref: string;
  _type: "reference";
  _weak?: boolean;
  [internalGroqTypeReferenceTo]?: "sanity.imageAsset";
}

interface Props {
  node: {
    asset?: SanityImageAsset | SanityImageRef;
  };
  alt: string;
}

const { node, alt } = Astro.props;

if (!node?.asset) return null;

const url = urlForImage(node.asset).url();
const webpUrl = urlForImage(node.asset).format("webp").url();
---

<picture>
  <source srcset={webpUrl} type="image/webp" />
  <img class="responsive__img" src={url} alt={alt} />
</picture>
